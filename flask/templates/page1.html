<!DOCTYPE html>
<html>
    <head>
        <title> ì˜ ë„ì°©í–ˆì§€ë¡± ğŸŒˆ </title>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <style>
        body {
            display: flex; /* Flex ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
            flex-direction: column;
            justify-content: center; /* ê°€ë¡œ ê°€ìš´ë° ì •ë ¬ */
            align-items: center; /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
            background-image: url("{{ url_for('static', filename='background.png') }}");
            background-size: cover; /* ë°°ê²½ ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ë§ê²Œ ì¡°ì ˆ */
            background-repeat: no-repeat; /* ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ë°˜ë³µí•˜ì§€ ì•ŠìŒ */
            background-position: center; /* ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ê°€ìš´ë°ë¡œ ì •ë ¬ */
            background-attachment: fixed;
        }
        .daterangepicker-container{
            text-align: center;
            padding: 10px;
        }

        input[type="text"] {
            width: 250px; /* Set the width as per your preference (e.g., 250px) */
            height: 25px; /* Set the height as per your preference */
            font-size: 20px; /* Set the font size to your desired value (e.g., 16px) */
            text-align: center;
        }
        .button-container {
            justify-content: center;
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 10px;
        }
        .button {
            width: 300px;
            margin: 5px;
        }

        .dropdown-menu {
            position: relative;
            display: inline-block;
            border: none;
            margin: 10px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            min-width: 100%;
            padding: 20px;
            border: 1px solid #ccc;
            z-index: 1;
            background-color: rgba(255,255,255,0.7);
        }

        .sub-content {
            z-index: 2;
        }

        .select-container {
            display: flex;
            justify-content: space-between;
        }

        select {
            min-width: 183px;
        }

        .submit-container {
            position: fixed;
            bottom: 150px;
        }
    </style>
</head>
<body>
    <h1> ì˜ ë„ì°©í–ˆì§€ë¡± ğŸŒˆ </h1>
    <div class="daterangepicker-container">
        <h3>ì—¬í–‰ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
        <input type="text" name="daterange" value="" />
    </div>
    <div class="button-container">
    {% for travel_item, columns in options.items() %}
    <div class="dropdown-menu {{ travel_item }} outer">
        <button class="button">{{ travel_item }}</button>
        <div class="dropdown-content {{ travel_item }} inner">
            <p>{{ travel_item_emojis[loop.index0] }}{{ travel_item }} ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”{{ travel_item_emojis[loop.index0] }}</p>
            {% for col_name, values in columns.items() %}
            <div class="select-container">
            <div class="col_name {{ col_name }}">
                <span>{{ col_name }}</span>
            </div>
            <select class="col_name {{ col_name }}" onchange="showSubContent('{{ travel_item }}', this.value)">
                {% if col_name != 'ê¸ˆì „ìƒí™©' %}
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                {% endif %}
                {% for value in values %}
                {% if col_name == 'ê¸ˆì „ìƒí™©' and value == 'í‰ë²”' %}
                <option value="{{ value }}" selected>{{ value }}</option>
                {% else %}
                <option value="{{ value }}">{{ value }}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
            <br/>
            {% endfor %}
            {% if travel_item == 'í•­ê³µê¶Œ' %}
            {% for additional_option_name, values in flight_additional_options.items() %}
            <div class="select-container">
            <div class="additional_option_name {{ additional_option_name }}">
                <span>{{ additional_option_name }}</span>
            </div>
            <select class="additional_option_name {{ additional_option_name }}" onchange="showSubContent('{{ travel_item }}', this.value)">
                {% if additional_option_name != 'í¸ë„/ì™•ë³µ' %}
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                {% endif %}
                {% for value in values %}
                {% if additional_option_name == 'í¸ë„/ì™•ë³µ' and value == 'ì™•ë³µ' %}
                <option value="{{ value }}" selected>{{ value }}</option>
                {% else %}
                <option value="{{ value }}">{{ value }}</option>
                {% endif %}
                {% endfor %}
            </select>
            </div>
            <br/>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endfor %}
    </div>

    <div class="submit-container">
        <button class="submit">ì¡°íšŒí•˜ê¸°</button>
    </div>

    <form id="myForm" method="get" style="display: none;" action="/2í˜ì´ì§€">
        <input type="text" name="input_data" id="inputData">
        <input type="text" name="additional_input_data" id="additionalInputData">
    </form>
    
    <script>
        // daterangepicker
        $(function() {
            var drp = $('input[name="daterange"]').daterangepicker({
                opens: 'left'
            });
        });
        // JSON ì¶œë ¥ì„ ìœ„í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
        document.querySelector(".submit").addEventListener("click", function () {
            const selectedOptions = {};
            const additionalSelectedOptions = {};
            const columnOptions = document.querySelectorAll(".col_name");
            const additionalOptions = document.querySelectorAll(".additional_option_name");

            columnOptions.forEach((select) => {
                const travelItem = select.parentElement.parentElement.className.split(" ")[1];
                const colName = select.className.split(" ")[1];
                const value = select.value;
                
                if (![null, undefined, ''].includes(value)) {
                    if (!selectedOptions[travelItem]) {
                        selectedOptions[travelItem] = [];
                    }
                    selectedOptions[travelItem].push({col_name: colName, value: value});
                }
            });

            additionalOptions.forEach((select) => {
                const colName = select.className.split(" ")[1];
                const value = select.value;
                
                if (![null, undefined, ''].includes(value)) {
                    additionalSelectedOptions[colName] = value;
                }
            });

            // ì„ íƒí•œ ì˜µì…˜ë“¤ì„ JSON í˜•íƒœë¡œ ì¶œë ¥
            const dates = $('input[name="daterange"]').val()
            selectedOptions['dateRange'] = dates

            // Add the data to the hidden form and submit the form
            document.getElementById("inputData").value = JSON.stringify(selectedOptions);
            document.getElementById("additionalInputData").value = JSON.stringify(additionalSelectedOptions);
            // console.log(selectedOptions);
            // console.log(additionalSelectedOptions);
            document.getElementById("myForm").submit();
        });

        // íŒì—… ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í‘œì‹œ/ê°ì¶”ê¸°
        const dropdownMenus = document.querySelectorAll("button");

        dropdownMenus.forEach((button) => {
            button.addEventListener("click", (event) => {
                const dropdownContent = event.target.nextElementSibling;
                dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
                event.stopPropagation();
            });
        });

        // ë¬¸ì„œì˜ ë‹¤ë¥¸ ë¶€ë¶„ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ê°ì¶”ê¸°
        document.addEventListener("click", (event) => {
            const allDropdownContents = document.querySelectorAll(".dropdown-content");
            allDropdownContents.forEach((content) => {
                // í´ë¦­ëœ ë‚´ìš©ê³¼ í•´ë‹¹ ë©”ë‰´ì˜ ë²„íŠ¼ì€ ë‹«ì§€ ì•Šë„ë¡ ì²˜ë¦¬
                if (content.contains(event.target) || event.target.classList.contains("sub-menu")) {
                    return;
                }
                content.style.display = "none";
            });
        });

        function showSubContent(category, selectedSubmenu) {
            const subContentPlaceholder = document.querySelector(`.dropdown-content.${category} .sub-content-placeholder`);
            const selectedSubContent = document.querySelector(`.dropdown-content.${category} .sub-content.${selectedSubmenu}`);

            if (selectedSubContent) {
                subContentPlaceholder.style.display = "none";
                selectedSubContent.style.display = "block";
            } else {
                subContentPlaceholder.style.display = "block";
            }
        }
    </script>
</body>
</html>